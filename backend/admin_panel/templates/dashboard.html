<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel de Administraci√≥n - ISLI</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        h1, h2 { color: #2C7873; }
        form { margin-bottom: 30px; }
        input, select, button { margin: 5px 0; padding: 5px; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        hr { margin: 40px 0; }
    </style>
</head>
<body>
    <h1>Panel de Control ISLI</h1>
    <p>Esta secci√≥n est√° disponible solo para usuarios con rol <strong>administrador</strong>.</p>

    <hr>

    <!-- üë§ Gesti√≥n de Usuarios -->
    <h2>Gesti√≥n de usuarios</h2>
    <p>Crea usuarios nuevos y asignales el rol correspondiente.</p>
    <form method="post" action="/admin/usuarios/crear">
        <label>Nombre:</label><br>
        <input type="text" name="nombre_usuario"><br>
        <label>Email:</label><br>
        <input type="email" name="email_usuario"><br>
        <label>Contrase√±a:</label><br>
        <input type="password" name="password"><br>
        <input type="hidden" name="token" value="{{ token }}">
        <label>Rol:</label><br>
        <select name="rol">
            <option value="operario">Operario</option>
            <option value="administrador">Administrador</option>
        </select><br>
        <button type="submit">Crear usuario</button>
    </form>

<h3>Registro de usuarios</h3>
<p>Visualiza usuarios, dalos de baja y/o asignales un nuevo rol.</p>
<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Email</th>
            <th>Rol</th>
            <th>Activo</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for user in usuarios %}
        <tr>
            <td>{{ user.id_usuario }}</td>
            <td>{{ user.nombre_usuario }}</td>
            <td>{{ user.email_usuario }}</td>
            <td>{{ user.rol }}</td>
            <td>
                {% if user.activo %}
                    <span style="color: green; font-weight: bold;">‚úîÔ∏è</span>
                {% else %}
                    <span style="color: red; font-weight: bold;">‚ùå</span>
                {% endif %}
            </td>
            <td>
                <form method="post" action="/admin/usuarios/toggle_activo" style="display:inline;">
                    <input type="hidden" name="id_usuario" value="{{ user.id_usuario }}">
                    <input type="hidden" name="token" value="{{ token }}">
                    <button type="submit">{{ 'Desactivar' if user.activo else 'Activar' }}</button>
                </form>

                <form method="post" action="/admin/usuarios/cambiar_rol" style="display:inline;">
                    <input type="hidden" name="id_usuario" value="{{ user.id_usuario }}">
                    <input type="hidden" name="token" value="{{ token }}">
                    <button type="submit">Cambiar rol</button>
                </form>
            </td>

        </tr>
        {% endfor %}
    </tbody>
</table>


    <hr>

    <!-- üß™ Gesti√≥n de Rollos -->
    <h2>Gesti√≥n de rollos</h2>
    <p>Devuelve rollos al almac√©n para volver a pasar el control de calidad.</p>
<h3>Rollos controlados</h3>

{% if rollos %}
<table>
    <thead>
        <tr>
            <th>ID</th>
            <th>Ruta local</th>
            <th>Estado</th>
            <th>Acci√≥n</th>
        </tr>
    </thead>
    <tbody>
        {% for rollo in rollos %}
        <tr>
            <td>{{ rollo.id_rollo }}</td>
            <td>{{ rollo.ruta_local_rollo }}</td>
            <td>{{ rollo.estado_rollo }}</td>
            <td>
                <form method="post" action="/admin/rollos/devolver">
                    <input type="hidden" name="id_rollo" value="{{ rollo.id_rollo }}">
                    <input type="hidden" name="token" value="{{ token }}">
                    <button type="submit">Devolver a control</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p style="color: gray; font-style: italic;">No hay rollos CONTROLADOS que mostrar.</p>
{% endif %}

    <hr>

    <!-- üìù Configuraci√≥n de informes -->
    <h2>Configuraci√≥n de informes</h2>
    <form method="post" action="/admin/configuracion/guardar">
        <label><input type="checkbox" name="incluir_nombre" checked> Incluir nombre de usuario</label><br>
        <label><input type="checkbox" name="incluir_fecha" checked> Incluir fecha de an√°lisis</label><br>
        <label><input type="checkbox" name="incluir_resultados" checked> Incluir resultados y defectos</label><br>
        <button type="submit">Guardar configuraci√≥n</button>
    </form>

</body>
</html>
